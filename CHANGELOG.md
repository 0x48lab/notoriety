# Changelog

このプロジェクトの全ての注目すべき変更はこのファイルに記録されます。

フォーマットは [Keep a Changelog](https://keepachangelog.com/ja/1.0.0/) に基づいています。

## [Unreleased]

### Added
- **ギルド設定機能（Guild Settings）**
  - ギルドマスターがGUIからギルド名、タグ、説明を変更可能
  - `/guild menu` → 「ギルド設定」（金床アイコン）からアクセス
  - チャット入力による設定変更（キャンセルは「cancel」入力）
  - タグカラー変更も設定画面に統合
- **領地モンスタースポーン設定**
  - ギルドマスターが領地内のモンスタースポーンを許可/禁止可能
  - `/guild territory mobspawn <on|off>` コマンドで設定
  - ギルド設定GUIからも設定可能（ゾンビヘッドアイコン）
  - スポナーやカスタムスポーンは設定に関わらず許可
- **NotorietyAPI公開**
  - NotorietyAPIをBukkitサービスとして登録
  - 他プラグインから `Bukkit.getServicesManager().getRegistration(NotorietyAPI::class.java)` でアクセス可能
  - ScenarioMakerプラグインとの連携を実現

### Changed
- ギルドメインメニューのレイアウト変更（マスター専用の設定ボタンを追加）
- ゴーレム強化をギルド領地内のみに制限（領地外では通常の強さ）
- 村人の灰/赤プレイヤーへのメッセージを穏やかな表現に変更

## [0.5.0] - 2025-01-18

### Added
- **シギルビーコン自動修復機能**
  - サーバー起動時に全シギルのビーコンを検証・修復
  - チャンクロード時にそのチャンク内のシギルを検証・修復
  - WorldEditやコマンドで消えたビーコンも自動復元

### Changed
- **シギルをアンカーとして領地解放ロジックを変更**
  - シギルのあるチャンクを解放 → グループ全体を解放
  - 隣接チャンクのみ解放 → そのチャンクだけ解放
- **自動縮小時のシギル保護**
  - メンバー減少時、シギルチャンクを最後まで保護
  - 非シギルチャンクを優先して削除
- 旧領地システムのマイグレーションを無効化（新規作成のみサポート）
- I18nManager統一APIを導入（全メッセージでAdventure API使用）

### Fixed
- マイグレーションで既存ビーコン位置を使用するよう修正
- 言語ファイルからレガシーフォーマットコード（§）を削除
- シギル名バリデーションの正規表現を修正（`\p{IsHan}`を使用）
- 領地解放時にシギルも正しく削除されるよう修正
- TerritoryProtectionListenerのレガシーフォーマットコード警告を修正

## [0.4.0] - 2025-01-18

### Added
- **チャンクベース領地システム（Territory Chunk System）**
  - Minecraftネイティブのチャンク座標（16×16ブロック）を使用
  - 領地上限計算: `1 + floor(memberCount / 3)` チャンク
  - `/guild territory set [シギル名]` - 現在のチャンクを領地として設定
  - `/guild territory info` - 領地情報（シギル一覧、チャンク一覧）を表示
  - `/guild territory release all` - 全領地を解放（確認付き）
  - `/guild territory release <番号>` - 特定チャンクを解放
- **シギルシステム（Sigil System）**
  - 連続した領地グループごとに1つのシギル（ビーコン）を自動配置
  - 飛び地（非隣接チャンク）は新しいシギルを自動作成
  - 複数グループを接続するチャンクを追加すると自動マージ
  - `/guild sigil list` - シギル一覧を表示
  - `/guild sigil rename <旧名> <新名>` - シギル名を変更
- **シギルテレポート**
  - `/guild home [シギル名]` - シギルへテレポート
  - シギルが1つの場合は名前省略可能
  - 複数シギルがある場合はリストを表示
  - クールダウン設定可能（デフォルト30秒）
- **政府ギルド（Government Guild）**
  - `/guild create <名前> <タグ> --government` - 政府ギルドを作成（OP専用）
  - 領地上限なし（無制限にチャンクを確保可能）
  - 作成費用無料
  - ギルド一覧に`[政府]`マーカーを表示
- **領地縮小システム**
  - メンバー減少時に自動で領地を縮小（LIFO順）
  - 空になったシギルグループは自動削除
- ギルド申請システム（Guild Application System）
  - `/guild apply <guild>` - ギルドに加入申請
  - `/guild applications` - 受信した申請一覧（マスター/副マスター用）
  - `/guild applications accept <player>` - 申請を承認
  - `/guild applications reject <player>` - 申請を却下
  - 申請有効期限: 7日間
- ギルドマスターログイン通知（領地状態をログイン時に表示）
- 調査モードで領地情報を表示（所有ギルド名を表示）
- 設定オプション追加
  - `territory.sigil-teleport-cooldown` - テレポートクールダウン（秒）
  - `territory.notifications-enabled` - 領地出入り通知の有効/無効

### Changed
- 領地システムをプレイヤー中心の16×16エリアからMinecraftネイティブチャンク座標に変更
- 領地上限計算を `10人=1チャンク` から `1 + floor(memberCount / 3)` に変更
- ビーコンの位置をチャンク単位ではなくシギル単位で管理するように変更
- PKCount が 0 になったとき懸賞金を出資者に返金するように変更
- 懸賞金コマンドを `set` から `add` に変更
- プレイヤー表示形式を変更（称号をprefix、ギルドタグをsuffixに表示）

### Fixed
- 自殺時にPKCountが増加するバグを修正
- オフラインプレイヤーに懸賞金を設定できない問題を修正
- `/noty admin` コマンドでオフラインプレイヤーを操作できない問題を修正
- SQLite接続プールのデッドロック問題を修正
- プレイヤー名の下に「0」が表示される問題を修正
- Adventure APIでのレガシーカラーコード警告を修正

## [0.2.9] - 2025-01-07

### Changed
- ペナルティバランスを5段階に調整
  - 重大犯罪（村人殺害[ベッド付]/窃盗/ゴーレム殺害）: -50
  - 中程度（動物殺害[目撃時]）: -20
  - 軽度（所有物破壊/村人殺害[ベッドなし]）: -10
  - 軽微（村人ベッド破壊/村人仕事場破壊）: -5
  - 最軽微（攻撃/作物収穫/村人攻撃）: -1
- 村人仕事場/ベッド破壊の免除条件に信頼者を追加（自分または信頼者が設置した場合は免除）
- CrimePoint/KarmaをAlignment(-1000〜+1000)に統合
- 称号ロジック変更: 青はFameのみ、赤はPKCountのみで決定
- BELOW_NAMEを使用した称号表示に変更（プレフィックス廃止）
- 村人取引の価格調整を実装（灰は1.5倍、高Alignmentで割引）
- ゴーレム検索範囲を64→128ブロックに拡大
- 村人メッセージをi18n対応（プレフィックス・警告メッセージ）
- 村関連犯罪を全プレイヤー（青・灰・赤）に適用

### Added
- ブロック所有者調査機能
  - `/noty inspect` - 調査モードのON/OFF切り替え（アクションバーに状態表示）
  - `/noty inspect tool` - 調査の棒を入手（エンチャント付きで光る特別なアイテム）
  - `/inspect` - エイリアスコマンド
  - 調査モード中または調査の棒でブロックをクリックすると所有者情報を表示
  - 表示内容: ブロック種類、位置、所有者名、設置日時、信頼関係
- 懸賞金看板リスナー（BountySignListener）- 看板に[bounty]と入力で登録、OP権限で設置/破壊可能
- 灰色プレイヤー用の称号を追加（Scoundrel, Rogue, Outlaw, Renegade）
- 管理者コマンド `/noty admin listgray` - 全灰色プレイヤー一覧（オンライン/オフライン状態表示）
- 管理者コマンド `/noty admin listred` - 全赤プレイヤー一覧（オンライン/オフライン状態表示）
- クリエイティブモード除外機能（所有権登録・犯罪判定をスキップ）
- 灰色プレイヤーへの村人警告システム（5%確率、2分クールダウン、6種類のメッセージ）
- ゴーレム独立検知機能（視認範囲32ブロック内で赤プレイヤーを検知、灰色プレイヤーの犯罪を目撃して攻撃）
- 犯罪通知システム（犯罪時・ネームカラー変更時にプレイヤーへ通知、被害者名表示）
- ゴーレム帰還機能（ターゲットを倒した/見失った後、村に戻る）
- ゴーレム自動強化機能（スポーン時に全ゴーレムを強化、攻撃されるとテレポートして反撃）
- 村人ベッド破壊犯罪（村人の紐づいているベッドを壊すとゴーレムに通報、Alignment -5）
- 村人仕事場破壊犯罪（村人の紐づいている職業ブロックを壊すとゴーレムに通報、Alignment -5）
- 村人攻撃犯罪（村人を攻撃するとゴーレムに通報、攻撃ごとにAlignment -1）
- ゴーレム殺害犯罪（ゴーレムを殺すと周囲のゴーレムが攻撃、Alignment -50）
- モンスター討伐報酬（モンスターを倒すとAlignment +1）

### Removed
- サイドバー表示機能を削除

## [0.2.0] - 2024-12-26

### Added
- サイドバーに称号・ステータス表示機能（2行固定）
- ペット攻撃ルール: 青色プレイヤーのペット攻撃でCrimePoint+150

### Changed
- 動物殺害ルール変更: 青色プレイヤーはペナルティなし、灰色/赤色はKarma+20のみ
- CrimePoint時間減少: 1時間ごとに-10、赤プレイヤーは-1000でPKCount-1

### Fixed
- PlayerData.addCrimePoint()を修正し赤プレイヤーのマイナス値を許可
- Skillsプラグインとの競合回避（既存Objectiveを共有）

## [0.1.0] - 2024-12-25

### Added
- 初期リリース
- 名声システム（Notoriety System）の実装
  - ネームカラー: 青（Innocent）、灰（Criminal）、赤（Murderer）
  - CrimePoint、PKCount、Karma、Fame パラメータ
  - 称号システム（Trustworthy, Notable, Famous, Lord 等）
- 所有権システム
- 信頼システム
- 犯罪履歴システム
- 懸賞金システム
- 村人・アイアンゴーレム連携
- コマンド: `/noty status`, `/noty history`, `/noty bounty`, `/noty trust`, `/noty admin`
- サードパーティAPI
- GitHub Actions によるビルド自動化
